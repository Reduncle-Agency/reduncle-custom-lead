{% comment %}
  Visualizador 3D Pro - Sección de Shopify
  Muestra la página personalizada desde Render
{% endcomment %}

{% if section.settings.modo == 'iframe' %}
  {% comment %} Opción 1: Mostrar en iframe {% endcomment %}
  <style>
    .render-iframe-container {
      width: 100%;
      height: 100vh;
      border: none;
      overflow: hidden !important;
      position: relative;
      -ms-overflow-style: none !important;
      scrollbar-width: none !important;
    }
    .render-iframe-container::-webkit-scrollbar {
      display: none !important;
      width: 0 !important;
      height: 0 !important;
    }
    .render-iframe-container iframe {
      width: 100%;
      height: 100vh;
      border: none;
      display: block;
      overflow: hidden !important;
      -ms-overflow-style: none !important;
      scrollbar-width: none !important;
    }
    .render-iframe-container iframe::-webkit-scrollbar {
      display: none !important;
      width: 0 !important;
      height: 0 !important;
    }
  </style>
  <div class="render-iframe-container">
    <iframe 
      src="{% if section.settings.logo_image %}{{ section.settings.render_url | default: 'https://reduncle-custom-lead.onrender.com' }}?logo={{ section.settings.logo_image | image_url | url_param_escape }}{% else %}{{ section.settings.render_url | default: 'https://reduncle-custom-lead.onrender.com' }}{% endif %}"
      frameborder="0"
      allowfullscreen
      allow="fullscreen"
      sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
      loading="lazy"
      id="render-iframe"
      scrolling="no"
    ></iframe>
  </div>
  
  <script>
    // Asegurar que el iframe cargue correctamente
    document.addEventListener('DOMContentLoaded', function() {
      const iframe = document.getElementById('render-iframe');
      if (iframe) {
        iframe.onload = function() {
          console.log('Iframe cargado correctamente');
        };
        iframe.onerror = function() {
          console.error('Error al cargar iframe');
        };
      }
    });
  </script>
{% else %}
  {% comment %} Opción 2: Redirigir directamente {% endcomment %}
  <script>
    {% if section.settings.logo_image %}
      window.location.href = "{{ section.settings.render_url | default: 'https://reduncle-custom-lead.onrender.com' }}?logo={{ section.settings.logo_image | image_url | url_param_escape }}";
    {% else %}
      window.location.href = "{{ section.settings.render_url | default: 'https://reduncle-custom-lead.onrender.com' }}";
    {% endif %}
  </script>
  
  {% comment %} Mensaje mientras redirige {% endcomment %}
  <div style="text-align: center; padding: 50px;">
    <p>Cargando visualizador 3D...</p>
    <p><a href="{{ section.settings.render_url | default: 'https://reduncle-custom-lead.onrender.com' }}">Click aquí si no redirige automáticamente</a></p>
  </div>
{% endif %}

{% schema %}
{
  "name": "Visualizador 3D Pro",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo_image",
      "label": "Logo",
      "info": "Logo que aparecerá arriba en la página (recomendado: máximo 200px de ancho)"
    },
    {
      "type": "text",
      "id": "render_url",
      "label": "URL de Render",
      "default": "https://reduncle-custom-lead.onrender.com",
      "info": "URL completa de la página en Render (puede ser la URL base o una URL de cliente específico)"
    },
    {
      "type": "select",
      "id": "modo",
      "label": "Modo de visualización",
      "options": [
        {
          "value": "iframe",
          "label": "Mostrar en iframe (embebido)"
        },
        {
          "value": "redirect",
          "label": "Redirigir a la página"
        }
      ],
      "default": "iframe",
      "info": "iframe: muestra la página dentro de Shopify. Redirect: redirige a la página completa."
    }
  ],
  "presets": [
    {
      "name": "Visualizador 3D Pro"
    }
  ]
}
{% endschema %}
